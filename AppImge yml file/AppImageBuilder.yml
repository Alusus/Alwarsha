# appimage-builder recipe see https://appimage-builder.readthedocs.io for details
version: 1
script: |
  rm -rf AppDir
  cd /root/build
  ninja
  DESTDIR=/root/AppDir ninja install
AppDir:
  path: /root/AppDir
  app_info:
    id: org.alusus.Alwarsha
    name: Alwarsha
    icon: org.alusus.Alwarsha
    version: latest
    exec: usr/bin/alwarsha
    exec_args: $@
  apt:
    arch:
      - amd64
    allow_unauthenticated: true
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy main restricted
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy universe
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy multiverse
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates main restricted
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates universe
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-updates multiverse
      - sourceline: deb http://archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security main restricted
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security universe
      - sourceline: deb http://security.ubuntu.com/ubuntu jammy-security multiverse
    include:
      # Direct dependencies
      - libglib2.0-0
      - libdazzle-1.0-0
      - libgtk-3-0
      - libpangocairo-1.0-0
      - libpango-1.0-0
      - libatk1.0-0
      - libcairo-gobject2
      - libcairo2
      - libgtksourceview-4-0
      - libtemplate-glib-1.0-0
      - libpeas-1.0-0
      - libgirepository-1.0-1
      - libvte-2.91-0
      - libjson-glib-1.0-0
      - libxml2
      - libwebkit2gtk-4.0-37
      - libsoup2.4-1
      - libjsonrpc-glib-1.0-1
      - libsysprof-4
      - libsysprof-ui-4
      - libpangoft2-1.0-0
      - libfontconfig1
      - libportal1
      - libportal-gtk3-1
      - libcmark0.30.2
      - libc6
      - libdevhelp-3-6
      - libflatpak0
      - libgladeui-2-13
      - libgspell-1-2
      - libenchant-2-2
      - libpcre3
      # Dynamic and indirect dependencies
      - gir1.2-dazzle-1.0
      - gir1.2-gtk-3.0
      - gir1.2-gtksource-4
      - gir1.2-json-1.0
      - gir1.2-jsonrpc-1.0
      - gir1.2-peas-1.0
      - gir1.2-template-1.0
      - gir1.2-vte-2.91
      - gir1.2-webkit2-4.0
      - gir1.2-handy-1
      - gir1.2-xdpgtk3-1.0
      - libcanberra-gtk3-module
      - librsvg2-common
      - libgit2-glib-1.0-0
      - python3-gi
      - python3-lxml
      - ugrep
      # Assets
      - adwaita-icon-theme
      - dmz-cursor-theme
      - hicolor-icon-theme
      - greybird-gtk-theme
      - fonts-dejavu-core
      - fonts-noto-core
      - fonts-noto-ui-core
      - language-pack-gnome-ar-base
  after_bundle: |
    mkdir "$TARGET_APPDIR/usr/lib/x86_64-linux-gnu/libpeas-1.0/loaders/python3"
    mv "$TARGET_APPDIR/usr/lib/x86_64-linux-gnu/libpeas-1.0/loaders/libpython3loader.so" "$TARGET_APPDIR/usr/lib/x86_64-linux-gnu/libpeas-1.0/loaders/python3/"
  runtime:
    env:
      APPDIR_PATH: '${APPDIR}'
      PATH: '${APPDIR}/usr/bin:${PATH}'
      APPDIR_LIBRARY_PATH: '$APPDIR/usr/lib/x86_64-linux-gnu:$APPDIR/lib/x86_64-linux-gnu:$APPDIR/usr/lib:$APPDIR/usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders'
      PEAS_PLUGIN_LOADERS_DIR: '$APPDIR/usr/lib/x86_64-linux-gnu/libpeas-1.0/loaders/'
      GDK_PIXBUF_MODULEDIR: '$APPDIR/usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/'
      PYTHONHOME: '${APPDIR}/usr'
      PYTHONPATH: '${APPDIR}/usr/lib/python3.9:${APPDIR}/usr/lib/python3.9/lib-dynload:${APPDIR}/usr/lib/python3/dist-packages'
AppImage:
  arch: x86_64
  update-information: guess
